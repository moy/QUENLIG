<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Quenlig : Questionnaire en ligne</title>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <link href="http://www710.univ-lyon1.fr/batiment/wiki.css" rel="stylesheet">
    <style type="">
      PRE {
      background: #F0F0F0;
      padding: 0.5em;
      border: 4px ridge #00FF00;
      }
      DIV.menu { position: fixed; left:0px ; top:0px ; width: 15em; }
      DIV.texte { margin-left:15em  }
      DIV.menu UL { padding-left: 1em ; margin-left: 0em ; }
    </style>
  </head>

  <body>
    <div class="menu">
    <p>
      Plan :</p>
    <ul>
      <li> <a href="#quoi">Qu'est ce donc ?</a></li>
      <li> <a href="#test">Essayez-le !</a></li>
      <li> <a href="#graphePython">Les questions Python</a></li>
      <li> <a href="#definir">Comment définir des exercices</a></li>
      <ul>
      <li> <a href="#name"><tt>name</tt></a></li>
      <li> <a href="#required"><tt>required</tt></a></li>
      <li> <a href="#before"><tt>before</tt></a></li>
      <li> <a href="#question"><tt>question</tt></a></li>
      <li> <a href="#nr_lines"><tt>nr_lines</tt></a></li>
      <li> <a href="#default_answer"><tt>default_answer</tt></a></li>
      <li> <a href="#bad_answer"><tt>bad_answer</tt></a></li>
      <li> <a href="#good_answer"><tt>good_answer</tt></a></li>
      <li> <a href="#highlight"><tt>highlight</tt></a></li>
      <li> <a href="#indices"><tt>indices</tt></a></li>
      <li> <a href="#oldtest">Anciens tests</a></li>
      <li> <a href="#newtest">Nouveaux tests</a></li>
      </ul>
      <li> <a href="#admin">Administration</a></li>
      <ul>
      <li> <a href="#lancement">Lancement du système</a></li>
      <li> <a href="#acl">ACL</a></li>
      <li> <a href="#outils">Outils de travail</a></li>
      <li> <a href="#methodes">Méthodes de travail</a></li>
      <li> <a href="#exploitation">Exploitation des trace</a></li>
      </ul>
      <li> <a href="#todo">TODO</a></li>
      <li> <a href="#nottodo">Not TODO</a></li>
      <li> <a href="#changements">Historique des changements</a></li>
    </ul>
    </div>

    <div class="texte">
    <h1>Quenlig : Questionnaire en ligne</h1>

    <h2><a name="quoi">Qu'est ce donc ?</a></h2>

    <h3>Il sert à faire des TP interactifs sur le Web</h3>
    <p>     
      Le fonctionnement est le suivant&nbsp;:</p>
    <ul>
      <li>
	Le système affiche les questions auxquelles
	l'étudiant peut répondre car il a validé les
	questions prérequises.
      </li>
      <li>
	L'étudiant choisit une question parmi celles proposées.
	Le système affiche alors&nbsp;:
	<ul>
	  <li>
	    Des informations générales sur la question
	    (rappels de cours, environnement, ...)
	  </li>
	  <li>
	    Le texte de la question.
	  </li>
	  <li>
	    Des liens permettant d'afficher des indices
	    permettant de répondre à la question
	  </li>
	  <li>
	    Une zone de saisie de la réponse.
	  </li>
	</ul>
      </li>
      <li>
	Quand l'étudiant répond bien il ne peut plus modifier
	sa réponse, sinon il peut proposer une autre réponse.
	Le système permet d'afficher des informations
	qui dépendent de la réponse de l'étudiant&nbsp;:
	<ul>
	  <li> Pour sa culture personnelle,</li>
	  <li> Pour le guider vers une bonne réponse,</li>
	  <li> Pour lui indiquer une réponse encore meilleure.</li>
	</ul>
      </li>
    </ul>

    <h3>Affichage de sa progression</h3>
    <p>
      Le système permet d'afficher de multiples informations
      pendant que l'étudiant travaille&nbsp;:</p>
    <ul>
      <li>
	Des statistiques sur son travail&nbsp;:
	<ul>
	  <li> Nombre de questions faites et à faire.</li>
	  <li> Nombre de bonnes/mauvaise réponses faites. </li>
	  <li> Nombre d'indices vus.</li>
	  <li> ... </li>
	</ul>
      </li>
      <li>
	Son classement à l'intérieur de l'ensemble des étudiants
	en train de travailler.
      </li>
      <li>
	Le temps restant pour faire le TP.</li>
      <li>
	La liste des questions donne des indications graphiques
	sur les questions&nbsp;:
	<ul>
	  <li> Une mauvaise réponse a été faite (rouge).</li>
	  <li> La question a été regardée (grise).</li>
	  <li> Des indices ont été demandés (italique)</li>
	</ul>
      </li>
    </ul>

    <h3>Actions possibles autre que répondre</h3>
    <p>
      Le système permet à l'étudiant de faire différentes actions,
      généralement on le laisse&nbsp;:</p>
    <ul>
      <li>
	Déposer un commentaire concernant la question affichée ou
	sur le système lui même.</li>
      <li>
	Se déconnecter.
      </li>
      <li>
	Afficher une page d'explication sur le TP et le système.
      </li>
      <li>
	Afficher une page contenant tout ce qu'il a fait.
      </li>
      <li>
	Afficher une page de statistiques concernant les questions vues.
      </li>
    </ul>

    <h3>Administration du système</h3>
    <p>
      L'administrateur quand à lui peut modifier les droits
      et les options&nbsp;:</p>
      <ul>
      <li> Par défaut.</li>
      <li> Des rôles administrateur/enseignant/auteur/étudiant.</li>
      <li> Des individus.</li>
      </ul>
    <p>
      Ces droits et options sont très précis, il y en a une quarantaine.
      Ils permettent de modifier les actions qu'il est possible de faire
      ou bien le contenu de la page web.</p>
    <p>
      Les droits permettent notamment&nbsp;:</p>
    <ul>
      <li> De voir ce que font les autres. </li>
      <li> D'avoir des statistiques globales par question/étudiant </li>
      <li> D'afficher histogrammes et autres graphiques </li>
      <li> D'avoir un fichier CSV permettant de calculer les notes. </li>
      <li> De détecter les étudiants travaillant ensemble</li>
      <li> Voir toutes les informations concernant la définition
	de la question, bonnes/mauvaises réponses testées par exemple.</li>
      <li> Voir les commentaires laissés par les étudiants.</li>
      <li> Voir les mauvaises réponses imaginées par les étudiants,
	et notamment les mauvaises réponses que le système
	n'a pas pu commenter ou bien les bonnes réponses 
	considérée comme mauvaise par le système.</li>
      <li> De recharger dynamiquement une question modifiée
	afin de voir par exemple si les mauvaises réponses
	restent sans commentaire après mise à jours du questionnaire.</li>
      <li> ...</li>
    </ul>

    <h2><a name="test">Essayez-le !</a></h2>
    <p>
      Les premières questions du TP unix sont très faciles,
      elle servent à vérifier que l'étudiant est capable
      d'utiliser le système.</p>
    <p>
      Voici quelques liens qui vous permettrons de l'utiliser
      sans l'installer&nbsp;:</p>
    <ul>
      <li> <a href="http://www710.univ-lyon1.fr/-quenlig-/guest.html">http://www710.univ-lyon1.fr/-quenlig-/guest.html</a>
	Utilisez le nom 'admin' pour devenir administrateur.
	Attention, le système suppose qu'il n'y a qu'une seule
	connexion simultanée par compte, il peut se passer
	des choses étranges si plusieurs personnes sont
	sur le même compte en même temps.</li>
      <li> <a href="http://proxy710.univ-lyon1.fr:9877/-quenlig-/guest.html">http://proxy710.univ-lyon1.fr:9877/-quenlig-/guest.html</a> Cours Python
	accessible seulement sur notre intranet.</p>
</li>
    </ul>

    <h2><a name="graphe">Graphe des questions</a></h2>
    <p>
      Le graphe des questions peut être affiché
      de différentes manière.
      Voici ce que donne l'une d'elle.</p>

    <h2><a name="graphePython">Python</a></h2>
    
    <a href="Students/python/HTML/xxx.ps"><img src="Students/python/HTML/xxx.png" alt=""></a><br>



    <h2><a name="definir">Comment définir des exercices</a></h2>

    <p>
      Les exercices sont définis par les programmes Python
      stockés dans le répertoire
      <a href="Questions/unix">Questions/unix</a>
      dans le cas du questionnaire Unix.
      Chaque programme Python peut définir plusieurs exercices.
      Voici un exemple de programme Python.
    </p>
    <pre>
# -*- coding: latin-1 -*-             # Pour pouvoir mettre des accents
from questions import *               # Interface avec la base d'exercices
from check import *                   # Les vérificateurs pour le shell

add(name="copie de fichier",
    before = """Regardez dans votre cours, chapitre 2""",
    question="""Quelle commande permet de copier un ou des fichiers ?""",
    tests=(
           Good(Equal("cp")),
           Bad(Comment(Equal("copy"),
                       "C'est la commande MS-DOS pas UNIX")),
           Bad(Comment(Equal("CP") | Equal("Cp"),
                       "Sous UNIX la casse est importante"),
          ),
   )

add(name="copie de répertoire",
    required=["cp", "intro:final"], # Exercices à faire avant celui-ci
    question="""Quelle est l'option de <tt>cp</tt> pour faire une copie récursive ?""",
    tests=(
           Good( UpperCase(Equal("-R")) | Equal("--recursive") ),
           Good( Comment(Equal("-a"), "Elle fait plus que la copie !") ),
          ),
    indices = ("Il faut ajouter une option",
               "La première lettre de récursif est...",
              ),
   )</pre>
    <p>
      Le nom du fichier contenant les questions est important,
      ce sera&nbsp;:
    </p>
    <ul>
      <li> Le nom du langage/norme sur lequel on pose les questions.</li>
      <li> Un verbe français indiquant ce que fait la commande
	si c'est à propos d'une commande.
      </li>
      <li> Le nom du concept si c'est un concept.</li>
    </ul>

    <h3>Les chaînes de caractères</h3>

    <h4>Codage des chaînes de caractères</h4>

    <p>
      Les chaînes de caractères sont en <tt>latin1</tt>
      et aussi en HTML si c'est dans des commentaires.
      Donc attention aux caractères &lt;, &gt;, &amp;.
    </p>
    <p>
      De plus un système de remplacement est fait
      donc si vous voulez afficher un <tt>%</tt>
      il faut le doubler.
    </p>

    <h4>Paramètres remplacés</h4>

    <p> Tous les textes visibles par l'utilisateur peuvent
      contenir des marqueurs de la forme '<tt>%(paramètre)s</tt>'
      Ces marqueurs sont remplacés lors de l'affichage
      par la valeur du paramètre.
    </p>
    <ul>
      <li> <tt>student_name</tt> est le nom de l'étudiant.</li>
    </ul>
    <p>
      Il y en a plein d'autres, mais je ne pense pas
      qu'ils soient utiles pour poser les questions.
    </p>
    <p>
      <b>FAUT-IL SUPPRIMER CETTE FONCTIONNALITE DANGEREUSE ?</b>&nbsp;:
	Oui, la nouvelle manière d'écrire les tests répond
	à ces problèmes mais ce n'est pas encore implémenté.
</p>

    <h4>Longues chaînes de caractères</h4>

    <p>
      Vous pouvez utilisez des triples guillemets au lieu des
      simples pour pouvoir mettre des retours à la ligne ou
      des guillemets dans la question.
    </p>

    <h3><a name="name">Paramètre : <tt>name</tt></a></h3>

    <p>
      C'est lui qui donne un nom à la question.
      Ce nom est celui qui sera affiché pour que l'étudiant
      puisse choisir sa question.
    </p>
    <ul>
      <li> Il doit être court car il est dans une colonne de menu.</li>
      <li> Il ne doit pas contenir de '<tt>/</tt>' </li>
      <li> S'il ne contient pas de '<tt>:</tt>' alors
	il est automatiquement préfixé par le nom du fichier courant.</li>
      <li> Il ne doit pas donner d'indication sur la réponse.</li>
    </ul>

    <h3><a name="required">Paramètre : <tt>required</tt></a></h3>

    <p>
      Il contient une liste de noms des questions auxquels l'étudiant
      doit déjà avoir répondu avant que celle-ci s'affiche.
    </p>
    <p>
      Si ce paramètre n'est pas indiqué, alors seule la question
      précédente est considérée comme requise.
      Il n'y a donc aucun prérequis pour la première question
      du fichier dans ce cas.
    </p>
    <p>
      Si un nom de questions contient le caractère '<tt>:</tt>'
      alors on ne le touche pas, sinon on le préfixe
      par le nom du fichier courant.
    </p>
    <p>
      Si le nom est suivie par une expression régulière entre parenthèse
      alors la réponse de l'étudiant à cette question doit
      vérifier l'expression régulière.
      <tt>personnel:sexe([mM])</tt>
      permet de n'afficher la question que si la réponse <tt>m</tt>
      ou <tt>M</tt> a été donnée à la question <tt>sexe</tt>
      du fichier <tt>personnel.py</tt>
    </p>

    <h3><a name="before">Paramètre : <tt>before</tt></a></h3>

    <p>
      Ce paramètre contient un texte qui sera affiché avant
      la question elle-même.
      Cela pourra être un rappel de cours ou bien une action
      à faire par l'étudiant pour qu'il puisse répondre à la question.
    </p>

    <h3><a name="question">Paramètre : <tt>question</tt></a></h3>

    <p>
      Il peut simplement être le texte de la question.
    </p>
    <p>
      Il peut aussi être une fonction sans paramètres retournant
      un chaîne de caractères.
      Avant l'appel de la fonction le système définit
      la graine de la série aléatoire si la question
      est aléatoire.
    </p>
    <p>
      Pour mettre l'image <tt>toto.png</tt> dans la question :
      <tt>&lt;IMG SRC='toto.png'&gt;</tt>
      Cette image sera dans le répertoire HTML du répertoire
      qui contient la définition des questions.
    </p>

    <h3><a name="nr_lines">Paramètre : <tt>nr_lines</tt></a></h3>

    <p>
      Cet entier indique le nombre de lignes de la zone
      dans laquelle l'étudiant va répondre.
      Par défaut 1.
    </p>

    <h3><a name="default_answer">Paramètre : <tt>default_answer</tt></a></h3>

    <p>
      C'est la réponse par défaut proposée quand
      l'utilisateur arrive sur la question pour la première fois.
    </p>


    <h3><a name="bad_answer">Paramètre : <tt>bad_answer</tt></a></h3>

    <p>
      C'est un texte qui sera affiché <b>dans tous les cas</b>
      si l'étudiant donne une mauvaise réponse.
      Au dessus de ce texte il sera écrit&nbsp;:
      ``peut être que ...´´
    </p>
    <p>
      Il est conseillé d'utiliser le test <tt>comment</tt>
      qui n'affichera rien si un autre commentaire a
      déjà été affiché pour l'étudiant.
    </p>

    <h3><a name="good_answer">Paramètre : <tt>good_answer</tt></a></h3>

    <p>
      C'est un texte qui sera affiché dans tous les cas
      si l'étudiant donne une bonne réponse.
      Au dessus de ce texte il sera écrit&nbsp;:
      ``saviez vous que ...´´
    </p>


    <h3><a name="highlight">Paramètre : <tt>highlight</tt></a></h3>

    <p>
	Si il est mis à True alors le lien vers la question est
	mis en évidence pour que l'étudiant y réponde
	prioritairement (mais il n'est pas forcé).
    </p>

    <h3><a name="indices">Paramètre : <tt>indices</tt></a></h3>

    <p>
      Une liste de chaines de caractères contenant
      des indices pour aider l'étudiant s'il le demande.
      Les indices sont proposés dans l'ordre, un par un.
    </p>

    <h3><a name="oldtest">Paramètre : <tt>tests</tt> ANCIENNE DOCUMENTATION</a></h3>
      <p>
	ATTENTION : cette documentation est obsolète,
	les tests ne sont plus à définir de cette façon.

    <p>
      C'est une liste de tests.
      Les tests sont effectués dans l'ordre jusqu'à ce qu'un
      test indique que la réponse est mauvaise ou bonne (True/False).
      Si le test retourne None alors il peut ajouter un commentaire
      qui sera affiché à l'étudiant.
      Des commentaires successifs peuvent s'afficher.</p>
    <p>
      Les fonctions de tests suivantes sont définies par défaut.</p>

    <h4>Test : <tt>good</tt></h4>

    <p>
      Si la réponse est exactement identique alors
      on considère que c'est une bonne réponse et l'on retourne
      le commentaire associé à la bonne réponse.
    </p>
    <pre>good( "a" ),
good( "A", "Je préfère &lt;tt&gt;a&lt;/tt&gt; comme réponse" ),
good( ("c", "d") ),
good( ("C", "D"), "Ok, mais je préfère les minuscules" ),</pre>

    <h4>Test : <tt>bad</tt></h4>

    <p>
      Si la réponse est exactement identique alors
      on considère que c'est une mauvaise réponse et l'on retourne
      le commentaire associé à la mauvaise réponse.
    </p>
    <p>
      La syntaxe est la même que <tt>good</tt>
    </p>

    <h4>Test : <tt>require</tt></h4>

    <p>
      Si la réponse ne contient pas la chaine
      on considère que c'est une mauvaise réponse et l'on retourne
      le commentaire associé à la bonne réponse.
    </p>

    <pre>require( "a" ),
require( "A", "Et alors, ou il est le &lt;tt&gt;A&lt;/tt&gt;" ),
require( ("c", "d") ),
require( ("C", "D"), "Et C et D ? Ou sont-ils ?" ),</pre>

    <h4>Test : <tt>require_startswith</tt> et <tt>require_endswith</tt></h4>

    <p>
      Si la réponse ne commence ou fini pas par la chaine
      on considère que c'est une mauvaise réponse et l'on retourne
      le commentaire associé à la bonne réponse.
    </p>

    <pre>require_startswith("/", "Un nom absolu commence par /"),
require_endswith(".html", "Il faut indiquer que c'est du HTML"),
</pre>

    <h4>Test : <tt>reject</tt></h4>

    <p>
      Si la réponse contient la chaine
      on considère que c'est une mauvaise réponse et l'on retourne
      le commentaire associé à la mauvaise réponse.
    </p>
    <p>
      La syntaxe est la même que <tt>require</tt>
    </p>

    <h4>Test : <tt>reject_startswith</tt> et <tt>reject_endswith</tt></h4>

    <p>
      Si la réponse commence ou fini par la chaine
      on considère que c'est une mauvaise réponse et l'on retourne
      le commentaire associé à la bonne réponse.
    </p>

    <pre>reject_startswith("/", "Un nom relatif ne commence pas par /"),
reject_endswith("/", "Le / final est inutile"),
</pre>



    <h4>Test : <tt>require_int</tt></h4>
    
    <p>
      Ce test sans paramètre refuse la réponse
      si ce n'est pas un entier.</p>

    <h4>Test : <tt>answer_length_is</tt></h4>
    
    <p>
      Ce test a pour paramètre la longueur de la réponse
      attendue et un commentaire à retourner si ce n'est pas la bonne.</p>

    <h4>Test : <tt>number_of_is</tt></h4>
    
    <p>
      Ce test a pour paramètres une chaine de caractère
      et le nombre requis d'occurrence de cette chaine
      de caractère dans la réponse de l'étudiant.
      Le dernier paramètre est le commentaire.
    </p>

    <h4><tt>comment</tt></h4>
    
    <p>
      Cette fonction a pour paramètre un commentaire.
      Dans tous les cas ce commentaire est ajouté
      à ce que l'étudiant va voir comme indication
      sur sa réponse.</p>
    <p>
      Son utilisation la plus naturelle est de le mettre en dernier
      dans la liste des tests afin de donner un conseil
      général à l'étudiant quand on a pas pu lui faire
      un commentaire lui expliquant pourquoi sa réponse est mauvaise.</p>



    <h4>Test : <tt>shell_good</tt>, <tt>shell_bad</tt>, <tt>shell_required</tt>, <tt>shell_reject</tt>, </h4>

    <p>
      Ces tests sont utilisés pour les TP utilisant
      le shell et ne sont pas utiles pour les autres.</p>

    <p>
      Le fonctionnement et la syntaxe sont la même que ceux
      sans <tt>shell_</tt>.
      Les différences sont&nbsp;:
    </p>
    <ul>
      <li> Pour  <tt>shell_good</tt> et <tt>shell_bad</tt>, 
	on compare les chaines de caractères après qu'elles aient
	été canonisées par un <em>parser</em> shell.</li>
      <li> Pour  <tt>shell_require</tt> et <tt>shell_reject</tt>, 
	on compare les chaines de caractères fournies dans la question
	à la réponse de l'étudiant <em>parsée</em> et traduite en XML.
	(le XML généré est visible dans les sources de la page HTML)</li>
      <li> Ces fonctions supportent le paramètre nommé <tt>dumb_replace</tt>
	qui permet de faire des substitutions avant de tester.
	L'exemple suivant décrit 3 substitutions à faire.
	<pre>dumb_replace = ( ("${HOME}", "$HOME"),  (("~/.", "$HOME/"), "~/") )</pre></li>
      <li> Ces fonctions supportent le paramètre nommé <tt>replacement</tt>
	qui travaille sur le XML et qui comprend la syntaxe des options
	longues et courtes afin de les normaliser en option courte
	en concaténant le nom de l'option et sa valeur.
	<pre>replacement=( ("-d", "--directory", 0), ("-w", "--width", 1) )</pre>
	L'exemple précédent fait les subtitutions&nbsp;:
	<ul>
	  <li> <tt>--directory</tt>  --&gt; <tt>-d</tt></li>
	  <li> <tt>-w 5</tt> --&gt; <tt>-w5</tt></li>
	  <li> <tt>--width 5</tt> --&gt; <tt>-w5</tt></li>
	  <li> <tt>--width=5</tt> --&gt; <tt>-w5</tt></li>
	</ul>
	Par défaut pas mal de substitutions
	sont faites par <tt>shellParser.py</tt></li>
    </ul>


    <h4>Test : <tt>shell_display</tt></h4>
    
    <p>
      Ce test sans paramètre affiche simplement l'arbre syntaxique
      de la commande shell.
      Il doit être indiqué en dernier sinon il risque
      d'être affiché deux fois car les autres tests l'affichent
      quand ils interrompent la vérification .</p>


    <h3><a name="newtest">Paramètre : <tt>tests</tt> NOUVELLE MANIÈRE</a></h3>

    <p>
      C'est une liste de tests.
      Les tests sont effectués dans l'ordre jusqu'à ce qu'un
      test indique que la réponse est mauvaise ou bonne (True/False).
    <p>
	Un test est une expression algébrique
	définissant ce qu'il faut répondre à l'étudiant.

	<ul>

	<li> Racine de l'expression&nbsp;:
	  <ul>
	      <li> <tt>Good(...)</tt> Bonne réponse si ... est vrai.
	      <li> <tt>Bad(...)</tt> Mauvaise réponse si ... est vrai.
	  </ul>

	<li> Ajouter un commentaire&nbsp;:
	  <tt>Comment(..., "texte du commentaire")</tt>
	  le commentaire est affiché quand ... est vrai.
	  
	<li> Les feuilles retourne vrai si la réponse de l'étudiant&nbsp;:
	  <ul>
	      <li> <tt>Equal("chaine")</tt> : est égale à "chaine".
	      <li> <tt>Start("chaine")</tt> : commence par "chaine"
	      <li> <tt>End("chaine")</tt> : finie par "chaine"
	      <li> <tt>Contain("chaine")</tt> : contient "chaine"
	      <li> <tt>Int()</tt> : est un entier
	      <li> <tt>IntGT(valeur)</tt> : est strictement supérieure à valeur
	      <li> <tt>IntLT(valeur)</tt> : est strictement inférieure à valeur
	      <li> <tt>Length(longueur)</tt> : est de la longueur indiquée
	      <li> <tt>NumberOfIs(chaine,nb)</tt> : contient <em>nb</em>
	      fois <em>chaine</em>
	      
	  </ul>

	<li> Opérateurs booléen&nbsp;:
	  <ul>
	    <li> <tt>... | ...</tt> vrai si l'un des deux est vrai.
	    <li> <tt>... &amp; ...</tt> vrai si les deux sont vrai.
	    <li> <tt>~ ...</tt> vrai si ... est faux.
	  </ul>

	<li> Modificateurs de réponse&nbsp;:
	  <ul>
	    <li> <tt>UpperCase(...)</tt> fait tous les traitements en majuscule
	    <li> <tt>Replace( ((old1, new1), (old2, new2), ...),
		...)</tt> fait toutes les substitutions de chaines de
	      caractères indiquées.
	    <li> <tt>SortLines(...)</tt> trie les lignes dans tous les traitements.
	  </ul>
      </ul>

    <h4>Ajouter un test</h4>
      <p>
	Les tests sont simple à réaliser.
      <ul>
	<li> <tt>student_answer</tt> est ce que l'étudiant a tapé (après
	  être passé à travers les modificateurs de réponse)
	<li> <tt>state</tt> est la session de l'étudiant.
	  Ceci permet de faire des tests qui dépendent de l'étudiants.
	<li> <tt>parser</tt> est la fonction à appeler pour
	  appliquer les modificateurs à la réponses prévue par
	  celui qui a écrit le test.
      </ul>

      <p>Une feuille de test (elle n'utilise pas <tt>state</tt>),
	par exemple&nbsp;:
<pre>
class Equal(TestString):
    def __call__(self, student_answer, state=None, parser=no_parse):
        return student_answer == parser(self.string, state, self), ""
</pre>
      <p>Un modificateur pouvant utiliser <tt>state</tt> pour modifier
	en fonction de l'étudiant.
	C'est un peu compliqué car il peut y avoir des modificateurs
	de modificateur.
	D'autre part, la modification peut être faite ou non en fonction
	du <tt>test</tt> réalisé, par exemple le modificateur s'applique
	à <tt>Equal</tt> mais pas à <tt>Contain</tt>.
	
<pre>
class UpperCase(TestUnary):
    def __call__(self, student_answer, state=None, parser=no_parse):
        return self.children[0](
            student_answer.upper(), state,
            lambda string, state, test: parser(string.upper(), state, test))
</pre>



    <h3>Variable : <tt>questions.current_evaluate_answer</tt></h3>
    <p>
      Quand <tt>add</tt> est appelé, il stocke la valeur courante
      de cette variable dans la question elle même,
      cela évite de redonner ce paramètre à chaque <tt>add</tt>.
    <p>
      Cette variable contient une fonction paramétrée par
      la réponse de l'utilisateur et <tt>state</tt>.
      Elle retourne un texte qui sera affiché dans le cadre
      nommé <em>Ce qui est obtenu</em>.
    <p>
      Dans le cas de Python, c'est le résultat de l'évaluation
      du code Python.
    <p>
      Cette implémentation de la fonctionnalité ne me plait
      pas car elle n'est pas esthétique.
      Elle va certainement être recodée.
    <p>
      Cette fonctionnalité n'est pas utilisée dans le questionnaire
      <tt>unix</tt> c'est pour cela qu'il y a <tt>shell_display</tt>
      presque systématiquement à la fin de la liste des tests.

    <h2><a name="admin">Administration du système.</a></h2>

    <p>
      Le système n'a été testé que sous Linux.
      Quelque points de détails l'empêcheront de fonctionner
      sous Windows.
    </p>
    
    <p>
      Le fichier <tt><a href="configuration.py">configuration.py</a></tt>
      contient quelques paramètres de configuration, notemment
      l'adresse du serveur CAS pour l'authentification.
    </p>

    <p>
      Le répertoire
      <a href="HTML">HTML</a>
      contient le fichier squelette de la page HTML ainsi
      que le fichier CSS qui contient tous les textes de l'interface.
      Il y a un fichier CSS par langue.
    </p>


    Les Packages obligatoires&nbsp;:
    <ul>
      <li> python</li>
    </ul>
    Les Packages recommandés&nbsp;:
    <ul>
      <li> netpbm ou pbmplus pour <tt>ppmtogif</tt> pour 'question_pixel_map'</li>
      <li> highlight pour l'affichage du code source python coloré.</li>
    </ul>
    Les Packages optionnels&nbsp;:
    <ul>
      <li> xvcg et graphviz pour l'affichage du graphe des questions.</li>
      <li> gnuplot pour l'affichage des stats de charge.</li>
      <li> weblint pour les tests de régression</li>
      <li> kcachegrind et kcachegrind-converters pour le profiling</li>
    </ul>

    <h3><a name="lancement">Lancement du système</a></h3>

    <p>
      Pas besoin de compiler c'est du Python.<br>
      Pour voir toutes les options de lancement tapez&nbsp;: <tt>main.py</tt><br>
      Les options de lancements sont concaténables.</p>
    <table border="1">
	<tbody><tr>
	  <td>
	    Création d'une session
	  </td>
	  <td>
	    <tt>main.py NomSession create RépertoireQuestions NumeroPort</tt><br>
	    Ceci crée les répertoires mais ne lance pas le serveur.
	  </td>
	</tr>
	<tr>
	  <td>
	    Définition de la date de début de TP
	  </td>
	  <td>
	    <tt>main.py NomSession begin_date DateDébut</tt><br>
	    Les dates sont sous la forme : <tt>"8:30 15/3/2006"</tt>
	  </td>
	</tr>
	<tr>
	  <td>
	    Définition de la date de fin de TP
	  </td>
	  <td>
	    <tt>main.py NomSession end_date DateDébut</tt><br>
	  </td>
	</tr>
	<tr>
	  <td>
	    Désignation de l'administrateur
	  </td>
	  <td>
	    <tt>main.py NomSession admin NomDuCompte</tt>
	  </td>
	</tr>
	<tr>
	  <td>
	    Lancement du serveur
	  </td>
	  <td>
	    <tt>main.py NomSession start</tt><br>
	    Le serveur vous affiche l'URL qu'il faut utiliser pour l'atteindre.
	  </td>
	</tr>
	<tr>
	  <td>
	    Détection de problèmes
	  </td>
	  <td>
	    <tt>main.py NomSession problems</tt><br>
	    Indique à l'auteur du questionnaire les bonnes réponses
	    données par les étudiants durant la session qui
	    ne sont plus acceptées par le nouveau système.
	  </td>
	</tr>
      </tbody>
    </table>
    <p>

    <h3><a name="acl">Les ACLs</a></h3>

    <p>
      Chaque fonctionnalité du système a son ACL.
      Si une ACL est préfixée par <tt>!</tt> alors
      elle est enlevée même si elle est autorisée
      pour tout le monde (<tt>question_shuffle</tt> pour les profs par exemple).
      Ou interdir à un étudiant de répondre aux questions, ...</p>
    <p>
      Toute les descriptions des ACL sont visibles
      sur la page web permettant de modifier leur valeur.
    </p>
    <p>
      Il est compliqué de modifier les ACLs une par une pour faire
      ce que l'on veut, c'est pour cela qu'il est préférable
      d'utiliser des 'rôles'.
      Quand on endosse un rôle, on prend les droits correspondant
      sans avoir besoin de modifier ses ACL.
      Les ACL personnelles sont prioritaires par rapport
      à celle du rôle.
      Les rôles existants&nbsp;:</p>
    <ul>
      <li> role_teacher_i_have</li>
      <li> role_author_i_have</li>
      <li> role_admin_i_have (peut modifier les ACLs de tout le monde)</li>
      <li> role_student_i_have (rôle par défaut)</li>
    </ul>

    <p>
      Le premier administrateur doit être créé avant
      le lancement du système.</p>
    <p>
      Si le serveur est trop lent ou les étudiants trop nombreux,
      enlevez l'ACL par défaut
      'question_pixel_map_see' qui consomme beaucoup de ressources.

    <h3><a name="outils">Outils</a></h3>
    <p>
      Taper <tt>make</tt> pour lister les buts possibles.
      Voici les principaux&nbsp;:
    <p>
      <tt>make regtest</tt> effectue des tests de régression.
      Il faut le lancer chaque fois que vous modifiez le système.
      pour s'assurer qu'il fonctionne toujours correctement.</p>
    <p>
      <tt>make load_simulator</tt> reprend rejoue en temps réel des sessions
      d'étudiants qui ont réellement travaillé.
      Il permet de simuler autant d'étudiant que l'on veut.
      Il stocke le temps moyens de réponse du serveur au cours du temps.</p>
    <p>
      <tt>make simulator_plot</tt> fait un affichage graphique
      des statistiques générées par <tt>make load_simulator</tt></p>
    <p>
      <tt>make profiling</tt> lance le simulateur avec le profiling
      pour voir ou le temps CPU passe.</p>
    <p>
      <tt>make plots</tt> génère l'affichage graphique
      du graphe des questions pour les différents questionnaires.
      Ainsi que de nombreux autres fichiers dans le répertoire
      HTML de chacune des sessions.
    </p>

      
    <h3><a name="methodes">Améliorer le questionnaire</a></h3>

    <p>
      Une fois le TP terminé, l'auteur du questionnaire
      doit l'améliorer pour que les étudiants reçoive un aide
      quand ils donne une mauvaise réponse.
      Ou bien pour tenir compte des commentaire des étudiants.
    <p>
      Avec vos droit enseignant, vous parcourez chaque question
      en cliquant sur 'question suivante'.
      Pour chaque question vous avez l'ensemble des mauvaises
      réponses données par le étudiants ainsi que les commentaires.
      Le fond rouge pour les mauvaises réponses indique
      que l'étudiant n'a eu aucun commentaire concernant
      sa mauvaise réponse.
      Après avoir mis la définition de la question à jour
      dans le fichier Python
      vous pouvez faire 'Recharge ce module' pour voir
      combien il reste de mauvaises réponses sur fond rouge.
      Pas besoin de relancer le serveur.
    </p>

    <h3><a name="exploitation">Exploitation de résultats des étudiants</a></h3>
    <p>
      Le système fourni énormément d'informations
      via les pages Web.
      Si néanmoins elles ne sont pas suffisantes,
      on peut les extraire des fichiers.</p>
    <p>
      Toutes les informations sont inscrites dans
      <a href="Students/unix/Logs">Students/nom_session/Logs</a>.
      Il y a un répertoire par étudiant contenant&nbsp;:</p>
    <ul>
      <li> un fichier <tt>acl</tt> contenant les droits d'accès,</li>
      <li> un fichier <tt>log</tt> contenant
	un ensemble d'enregistrement commençant toujours par&nbsp;:
	<ul>
	  <li> le nom de la question</li>
	  <li> le nombre de secondes depuis 1970</li>
	</ul>
	<p>
	  Les champs de l'enregistrement sont séparés par control A (^A).
	  La suite de la ligne peut être&nbsp;:
	</p>
	<ul>
	  <li> "<tt>asked</tt>" pour indiquer que l'on a posé la question à
	    l'étudiant.
	    Il y a autant de lignes que de fois que l'on a affiché
	    la question à l'étudiant.
	  </li>
	  <li> "<tt>question_indice_see</tt>" pour indiquer que l'étudiant
	    demande un nouvel indice.
	  </li>
	  <li> "<tt>good #</tt>" texte complet de la bonne réponse donnée
	    par l'étudiant.
	  </li>
	  <li> "<tt>bad ...</tt>" texte complet de la mauvaise
	    réponse donnée par l'étudiant.
	  </li>
	</ul>
      </li>
    </ul>



    <h2><a name="todo">Todo</a></h2>

    <p>
      Sur le système lui-même&nbsp;:</p>
    <ul>
	<li> Afficher erreur si le nom de la question contient des () </li>
	<li>
	  Décomposer le système en plugins pour simplifier la programmation
	  en regroupant ce qui est nécessaire pour faire une fonctionnalité
	  au même endroit.
	  À chaque plugin correspond&nbsp;:
	  <ul>
	    <li> un nom,
	    <li> une ACL (voir, modifier, cacher, ...),
	    <li> un style CSS,
	    <li> un style JavaScript,
	    <li> une priorité d'appel,
	    <li> une fonction qui mettra à jour la page à afficher
	      avec des ajouts ou des modifications.
	    <li> une fonction modificatrice d'état,
	  </ul>
	  </li>
	<li> Votre réponse contient des retours à la ligne : être
	  plus explicatif ou effacer la réponse...

	<li> Faire un éditeur interactif de question.</li>

	<li>
	  Ajouter la possibilité d'afficher l'historique des mauvaises
	  réponses et des commentaires affichés donnés par un étudiant.
	  Comme cela l'étudiant voit directement toutes ses mauvaises
	  réponses et les indices qui ont été donnés.
	</li>

	<li> Les attributs 'question', 'before', 'required', 'good_answer',
	  'indices', ...
	  doivent être définissables avec les même filtres
	  que les tests. Ce sont eux qui feront les substitutions
	  en fonction de l'état du système total et donc de l'étudiant.
	Cela permet aussi d'enlever les substitutions faites implicitements.
	  <p>
	    En profiter pour essayer de mieux séparer la logique
	    du test de la langue utilisée pour les messages aux
	    étudiants (require_ip par exemple).

</li>

	<li> Liste des questions </li>
      <li> Passer les noms d'invité en minuscules pour éviter les doublons,
	ajouter un anti-SPAMMER, limiter la tailler des noms</li>
	<li> Après une mauvaise réponse, afficher le fond de la zone
	  réponse en rouge pastel tant que l'étudiant n'a pas modifié
	  le texte de celle-ci&nbsp;?
      <li> Réécrire complètement le parser shell sans faire
	d'analyse lexicale/syntaxique car le shell n'est pas facilement
	parsable. </li>
      <li> Association id/vrai nom / photo / ... dynamique</li>
      <li> Faire en sorte que la canonisation shell fonctionne réellement,
	des substitution de chaines de caractères ne sont pas
	suffisantes.
	C'est shellSyntax qui doit réécrire les options longues en courtes.
      </li>
      <li> Indiquer pour chaque question les cheminements d'étudiant
           les plus long jusqu'à la bonne réponse (ou sans réponse)
	en affichant les indices donnés par le système.
      </li>
      <li> Indiquer l'adresse IP / machine de derniere connexion </li>
      <li> Faire en sorte que le SVG soit imprimable </li>
      <li> Afficher le mail de l'étudiant sur sa page de stat </li>
      <li> Tester le cas des noms d'utilisateur avec des '?'</li>
      <li> BUG: Le graphique des questions n'est pas affiché à la première
	connexion.</li>
      <li> Pouvoir envoyer un message à un étudiant, le message
	apparaîtra sur toutes les pages jusqu'à ce que l'étudiant le ferme.
	</li>
      <li> Liste des bonnes réponses COURTE pour diffuser aux étudiants</li>
      <li> Indiquer le nombre de caractères différents, la longueur,
	le nombre de mots par rapport à la bonne réponse la plus proche</li>
      <li> Mettre des classes de réponse pour le champs de saisie
	pour que le navigateur ne sorte pas toutes les réponses
	déjà données aux autres questions&nbsp;? </li>
      <li> Faire une question_map pour l'enseignant qui met
	en évidence les questions affichées sur les écrans des étudiants.</li>
      <li> Problème du background du SVG pour l'impression.
      <li> Changer les marges du SVG pour l'impression.
      <li> Pointeur SVG sur la carte des questions en pixels.</li>
      <li> Pouvoir cacher des mauvaises réponses et des commentaires.
	Pour soit-même ou pour tous le monde&nbsp;?
      <li> Problème langue sur la durée si elle est supérieur à 24 heures.</li>
      <li> Choix de la langue dans la configuration ?</li>
      <li> Amélioration vitesse : statistiques incrémentales.
	C'est obligatoire si l'on veut supporter des centaines
	  d'étudiants simultanés.</li>
      <li> Faire les boutons : 'il manque des indices', 'le message d'aide est inaproprié', ...
      <li> Liste des connectés ? Liste des étudiants ?</li>
      <li> Faire disparaitre configuration.py ?</li>
      <li> Le tester sous Windows</li>
    </ul>

    <p>
      Pour les différents questionnaires,
      il faut regarder dans <tt>Questions/.../TODO</tt>
<p>
	Nouvelle syntaxe de définition de test&nbsp;:
<ul>
<li> On utilise les opérateurs du langage : or and not </li>
<li> Une fonction 'good' ou 'bad' obligatoire
<li> Une fonction 'comment' qui ajoute un commentaire
<li> Des fonctions de test : 'Is', 'IsNumber', 'Contain', 'LengthIs', 'ShellIs'
</ul>
    

    <h2><a name="nottodo">Not Todo</a></h2>
    <ul>
      <li> Faire une 'thread' pour la partie affichage page ?<br>
	Non, car le système supporte sans problème en mono tache&nbsp;:
	<table border="1">
	    <tbody><tr><th>Nb Étudiants</th><th>Questionnaire</th><th>Mémoire</th><th>Max des temps moyens de réponse sur 5 minutes</th></tr>
	    <tr><td>50</td><td>unix</td><td>?</td><td>0.024 secondes</td></tr>
	    <tr><td>100</td><td>unix</td><td>?</td><td>0.035 secondes</td></tr>
	    <tr><td>200</td><td>unix</td><td>?</td><td>0.14 secondes</td></tr>
	    <tr><td>300</td><td>unix</td><td>70Mo</td><td>1.55 secondes</td></tr></tbody>
      </table>
	<p>Et faire du multi tâche complique inutilement bien que
	  cela ne devrait pas poser de problème grace à la séparation
	  <tt>action</tt> et <tt>page</tt>.</p>
	<p>
	  De plus, on peut encore optimiser le code.</p></li>
      <li> Mot de passe pour guest :<br>
	non car c'est le nom et cela n'en vaut pas la peine.</li>
      <li> URL avec que des ?x=y plus de / pour le numero et le nom :<br>
	NON car on ne peut pas utiliser BASE.</li>

    </ul>

    <h2><a name="changements">Changements</a></h2>
    <p>
      Changements faits lors du passage d'une version à l'autre.
    </p>


    <h3>0.5 ==&gt; 0.6</h3>
    
    <ul>
      <li> N'utilise plus de '..' dans les noms de fichiers.</li>
      <li> Ajout de 'css.fr.enfant.css', utilisation de CSS en cascade.</li>
      <li> Ajout tips sur 'recharge' et 'question suivante'.</li>
      <li> Les '/' dans les noms de fichier ont été enlevés.</li>
      <li> Ajoute l'affichage de la variance du temps de réflexion
	dans les statistiques étudiants</li>
      <li> On stocke le nom de la machine faisant tourner
	le serveur dans le répertoire session.</li>
      <li> Lancer 'main.py' sans paramètre affiche la liste des sessions.</li>
      <li> Le bouton 'déconnexion' n'apparaît plus si
	l'on se connecte avec <em>guest</em></li>
      <li> Le script 'move_question.py' a été créé pour déplacer/renommer
	des questions d'un fichier à un autre en mettant à jour
	les fichiers de log étudiant.</li>
      <li> Le questionnaire python a été découpé en plusieurs fichiers.</li>
      <li> Sur l'état du système,
	les questions les plus requises sont le plus à gauche.</li>
      <li> L'ACL 'question_pixel_map_see' permet d'afficher
	une carte des questions en pixel dans le menu de gauche.
	La couleur du pixel indique l'état de la question
	vis-à-vis de l'utilisateur.</li>
      <li> Bulle d'aide sur la carte des questions en pixels.</li>
      <li> L'ACL 'question_pixel_map_see_other' permet d'afficher
	la carte pixels des autres étudiants dans la liste des étudiants
	et leurs statistiques.</li>
      <li> La version Quenlig utilisée par le serveur est affichée.</li>
      <li> Dans la liste des questions pour un étudiant,
	n'affiche pas les questions pas vues.</li>
      <li> La date de première connexion est maintenant correcte.</li>
      <li> Les erreurs HTML ont été corrigées avec 'weblint 1.9.3</li>
      <li> On est plus obligé de donner les dates de TP lors
	de la création de session</li>
    </ul>

    <h3>0.6 ==&gt; 0.7</h3>
    
    <ul>
      <li> L'affichage du graphe des questions fonctionne
	maintenant avec des caractères accentués dans les noms
	de fichiers.</li>
      <li> Pour améliorer les exercices ou l'on doit systématiquement
	afficher le résultat d'une évaluation quelle soit
	juste ou non&nbsp;:
	La variable <tt>current_evaluate_answer</tt> a été ajoutée
	dans <tt>question.py</tt>.
      </li>
      <li> Les questions débloquant un maximum de questions suivantes
	sont mises en gras si on possède l'ACL 'question_max_descendants'
      </li>
      <li> L'ACL 'question_pixel_map_circle' permet de basculer
	l'ensemble des utilisateurs vers une carte ayant plus
	une forme de disque.</li>
      <li> La sortie SVG marche mieux avec InkScape (pour imprimer).</li>
      <li> Corrige de parser shell pour qu'il accepte les apostrophes
	entre guillemets.</li>
      <li> Corrige l'affichage du champs de saisie pour
	qu'il affiche correctement les guillemets.</li>
      <li> Réécriture de la vérification du ticket car c'était
	encore faux.</li>
      <li> L'envoit d'un commentaire vide n'affiche plus de message d'erreur.</li>
      <li> Meilleur traitement de \\ et du ^ dans le parser shell,
      ainsi que des séparateurs dans les syntaxes de remplacement</li>
      <li> Ajoute l'ACL 'question_time_see' permettant de voir dans
	le titre de la question le temps moyen de réflexion du groupe.</li>
      <li> Il est maintenant possible de se reconnecter si l'on
	s'est déconnecté.</li>
      <li> Dans les tests Python la quantité de mémoire et de CPU
	utilisée est limitée pour ne pas surcharger le serveur.</li>
      <li> Ajoute l'ACL 'gui_autofocus' car l'auto focus est pénible
	pour l'auteur du contenu (page down marche pas...).</li>
      <li> Ajoute tests : require_startswith, require_endswith,
	reject_startswith, reject_endswith</li>
      <li> Le nom public du serveur peut être indiqué en paramètre. </li>
    </ul>

    <h3>0.7 ==&gt; 0.8</h3>
    
    <ul>
      <li> Débuggage du simulateur de charge qui ne fonctionnait plus.</li>
      <li> Le CPU profiling est affiché avec kcachegrind.</li>
      <li> Bouche un gros trou de sécurité.</li>
    </ul>

    <h3>0.8 ==&gt; 0.9</h3>
    <ul>
      <li> Débuggage du simulateur de charge : cas des réponses contenant /.</li>
      <li> Création d'une animation temps réel de l'histogramme des bonnes réponses (but dans le Makefile).</li>
      <li> Quand on regarde les mauvaises réponses données par les étudiants,
	une bulle d'aide apparaît avec le message d'aide donné
	aux étudiants.</li>
      <li> Quand on regarde les mauvaises réponses données par les étudiants,
	le nom de l'étudiant apparaît en italique s'il a regardé
      un indice.</li>
      <li> Amélioration de la canonisation des options quand il y
	a plusieurs commandes sur la ligne.
	Il reste des bugs <tt>-n $(x)</tt> ne devient pas
	    <tt>-n$(x)</tt>.
      </li>
      <li> On ne perd plus les réponses et l'état courant
	au moment du renouvellement de ticket trop ancien.</li>
      <li> L'action 'détruire étudiants' à été ajoutée,
      elle enlève les étudiants avec 0 bonnes réponses.</li>
    </ul>

    <h3>0.9 ==&gt; 1.0</h3>

    <ul>
      <li> La vérification des questions est maintenant faite par un
	objet au lieu d'une fonction.
	On peut quand même faire une fonction mais cela n'est
	pas recommandé.
      </li>
	<li>
	  Les fonctions générant les textes 'question' et 'before'
	  peuvent prendre maintenant 'state' en paramètre
	  afin d'avoir des textes contextuel.
	  Les variables aléatoires et les substitions de texte
	  seront amenés à disparaitre du coeur du système.
	  </li>
      <li>
	Création automatique de <tt>__init__.py</tt> dans les répertoires
	de question.</li>
      <li> 'replace', 'dumb_replace' sont fait dans la classe Test
	au lieu d'être fait dans la fonction test.
	Cela s'applique à tous les tests.
	D'autres modificateurs ont été ajoutés, ils ne sont
	pas encore documentés.
      </li>
      <li> Et de très nombreux bugs ont été corrigés.</li>
	<li> Les questions ont un attribut 'highlight' permettant
	de les mettre en évidences (blanc sur noir) dans le menu
	des questions </li>
	<li> Le questionnaire Unix a subit 36 étudiants supplémentaires
	  et a été mis à jour en conséquence.</li>
	<li> Un questionnaire CISCO a été créé, il est expérimental
	  et ne peut fonctionner que si les équippements de la salle
	  de TP sont modélisés dans le système.</li>
	<li> La commande <tt>make</tt> est automatiquement lancée
	  dans le répertoire <tt>HTML</tt> des questions au lancement
	  du questionnaire.</li>
    </ul>
      </div>

    <hr>
    <address><a href="mailto:exco@@liris.univ-lyon1.fr">Thierry EXCOFFIER</a></address>
    <!-- Created: Sun Jul 24 15:23:19 CEST 2005 -->
    <!-- hhmts start -->
Last modified: Fri May 23 10:06:02 CEST 2008
<!-- hhmts end -->
  </body>
</html>
